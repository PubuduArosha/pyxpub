# pyxpub - Private Payment Gateway
 
Pyxpub is a simple self-hosted webapp that generates unique payment requests for Bitcoin Cash. It can do this as a simple webpage with a Bitcoin Cash address and corresponding QR code or as a JSON request. It can be accessed directly, be embedded in a webpage through an iframe, or you can do JSON requests through the API. All generated Bitcoin Cash addresses are derived from a pre-defined (Electron Cash) xpub key.

## Introduction
As per Bitcoin best practices it is preferred to use a new receiving address for each payment. This for security and privacy implications for both you and your customers or donators. Also, we do not want any private keys on the server generating the receiving address, nor would we want them on any PoS system. This can easily be achieved by using an hd-wallet as described in [BIP32](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki). This is the default wallet type when you create a new wallet with [Electron Cash](https://electroncash.org/).

### xpub (Electron Cash)
First, when you create a new wallet with Electron Cash, it is very important to propperly backup and safely store your mnemonic seed. This Electron wallet is your full (send & receive) wallet, make sure it is password protected and also stored safely. You will use it later to retrieve payments. The webapp will use the xpub key to generate receive only addresses on the server, corresponding to the addresses from your Electron wallet. This way we don't need private keys on the server. You can find your wallet's master public key or xpub key through the 'Wallet -> Information' menu.

### rate limit by ip
The app is currently rate limited to one unique address per ip address. This is done to prevent snooping and waste of addresses by page reloads when you expose the service publicly (a donation page for example). This is tracked in the ip.list file, generated by the app in the data directory. You can remove this file to erase this history. You can also setup a cron job to do this at whatever interval seems reasonable. The service does not need to be restarted when you remove the ip.list file. (TODO: enable/disable option for rate limiter.)

Keep in mind it is still best to be somewhat conservative with generating new addresses. Since unused addresses will unnecessarily grow your wallet. Because the addresses holding payments will have a wider gap between them, you will have to increase the gap parameter on your full wallet to find new payments. If you are not careful you end up with having to generate a whole bunch of addresses of which you only use a few.

## Installation
__clone repo__

    git clone https://github.com/acidsploit/pyxpub.git pyxpub

__setup environment__

    cd pyxpub/
    bash setup.sh

__set xpub key__

Copy your xpub key from an Electron Cash wallet and paste it in the key.list file.

    echo 'xpub...' > key.list

__run__

    cd pyxpub/
    bash pyxpub.sh

__access locally__

Browse to http://127.0.0.1:8080;


__access through nginx reverse proxy__

Set up a vhost (preferably with ssl) with following locations and proxy_pass:

    # Avoid robots
    location /robots.txt {
        return 200 "User-agent: *\nDisallow: /";
    }

    location  / {
        proxy_pass          http://127.0.0.1:8080;
        proxy_redirect      default;
        proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
        proxy_set_header    X-Real-IP $remote_addr;
        proxy_set_header    Host $host;
        proxy_set_header    X-Forwarded-Proto $scheme;
        proxy_hide_header   X-Powered-By;
    }

Allow localhost access to port 8080 in your firewall.

    iptables -A INPUT -i lo -p tcp -m tcp --dport 8080 -j ACCEPT


## Usage
### Direct browser access
As noted in the installation instructions, you can access the webapp locally through http://localhost:8080 or directly through the vhost you set up.

__default page__

    http://localhost:8080/
    
![pyxpub example 1](https://i.imgur.com/faDPHsF.png)

__default page with arguments__

    http://localhost:8080/?amount=0.0023&label=SHOP:PAYM123
    
![pyxpub example 2](https://i.imgur.com/vrXDnpZ.png)


Demo: https://donate.devzero.be

    
### JSON
You can also generate a new JSON formatted payment request through the api.

__payment request__

[jQuery Example](https://github.com/acidsploit/pyxpub/tree/master/examples/jquery)

Options:
* amount
* label

        http://localhost:8080/payment?amount=0.0023&label=SHOP:1Wed2B44

![pyxpub example 4](https://i.imgur.com/xuTKtVR.png)

        curl 'http://localhost:8080/payment?amount=0.0023&label=SHOP:1Wed2B44'

        {
        "payment": {
          "amount": "0.0023", 
          "addr": "bitcoincash:qpej4uw429m9m0wawcphw9v4sch2ymd6qsqh7jx9gl", 
          "legacy_addr": "1BVx9uf5UGJDt1eMqjut8qh1K4mmEeDSFQ", 
          "label": "SHOP:1Wed2B44", 
          "qr_img": "/qr?addr=bitcoincash:qpej4uw429m9m0wawcphw9v4sch2ymd6qsqh7jx9gl&amount=0.0023&label=SHOP:1Wed2B44", 
          "payment_uri": "bitcoincash:qpej4uw429m9m0wawcphw9v4sch2ymd6qsqh7jx9gl?amount=0.0023&message=SHOP:1Wed2B44"
          }
        }

### QR image only

    http://localhost:8080/qr?addr=bitcoincash:qpej4uw429m9m0wawcphw9v4sch2ymd6qsqh7jx9gl&amount=0.0023&label=SHOP:PAYM123


### Embedded iframe

     <iframe width=100% height=450px frameborder=0 src="https://donate.devzero.be"></iframe> 

Example: https://acidsploit.github.io/pyxpub/
